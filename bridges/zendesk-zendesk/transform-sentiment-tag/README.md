# Sentiment analysis of new Zendesk tickets using AWS Comprehend

This code demonstrates how to transform the data contained in CloudEvents originating from the [Zendesk event
source][zdsource-docs] by matching incoming events with their equivalent containing the result of a sentiment analysis
from [AWS Comprehend][aws-comprehend]. By doing so, it also provides an example of integration with a third-party
service inside a [Triggermesh Bridge][tmdocs-bridge].

The example is written in Go and released as a container image at
`gcr.io/triggermesh/bridge-examples/zendesk-zendesk-transform-sentiment-tag`.

## Design

![Transformation](../assets/transformation.gif)

`transform-sentiment-tag` performs a sentiment analysis of the Ticket description contained in a
`com.zendesk.ticket.created` event generated by a [Zendesk event source][zdsource-docs]. It relies on [AWS
Comprehend][aws-comprehend] to obtain this result, which in turn is used to emit a matching event of type
`com.zendesk.tag.create` that is meant to be consumed by a [Zendesk event target][zdtarget-docs]. The event target
ultimately places a `tag` on the corresponding Zendesk ticket, denoting if its sentiment is `POSITIVE`, `NEGATIVE`,
`MIXED`, or `NEUTRAL`.

## Runtime requirements

The following environment variables **must** be set:

* [`AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`][aws-creds]: credentials to authenticate API requests to AWS
  Comprehend.
* [`AWS_REGION`][aws-region]: AWS region in which the transformation service interacts with the AWS Comprehend API.
* [`LANGUAGE`][comprehend-lang]: the language AWS Comprehend should expect in the body of the Zendesk Ticket.

## Example

The following `curl` command can be issued against a `transform-sentiment-tag` deployment to test its functionality:

```console
$ curl -D- https://transform-sentiment-tag.example.com \
    -H "Content-Type: application/json" \ 
    -H "Ce-Specversion: 1.0" \
    -H "Ce-Type: com.zendesk.ticket.created" \
    -H "Ce-Source: curl" \
    -H "Ce-Id: 536808d3-88be-4077-9d7a-a3f162705f79" \
    -d '{"id": 86, "description": "I love you"}'
```

This request yields the following response:

```http
HTTP/1.1 201 Created
Ce-Id: 5aac91f8-5d48-4043-95d8-cf876b9b8153
Ce-Source: io.triggermesh.transformations.zendesk-sentiment-tag
Ce-Specversion: 1.0
Ce-Time: 2020-07-20T13:04:31.3769916Z
Ce-Transformtype: com.zendesk.ticket.created
Ce-Type: com.zendesk.tag.create
Content-Length: 26
Content-Type: application/json
Date: Mon, 20 Jul 2020 13:04:31 GMT

{"id":86,"tag":"POSITIVE"}
```

If we change the ticket description from "I love you" to "I hate you", the result from the sentiment analysis becomes
NEGATIVE.

[aws-comprehend]: https://aws.amazon.com/comprehend/
[aws-creds]: https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys
[aws-region]: https://aws.amazon.com/about-aws/global-infrastructure/regional-product-services/
[comprehend-lang]: https://docs.aws.amazon.com/comprehend/latest/dg/supported-languages.html

[tmdocs-bridge]: https://docs.triggermesh.io/guides/bridge/
[zdsource-docs]: https://docs.triggermesh.io/sources/zendesk/
[zdtarget-docs]: https://docs.triggermesh.io/targets/zendesk/
